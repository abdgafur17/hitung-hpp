<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator HPP UMKM - Perhitungan Akurat</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #5d6d7e;
            --secondary: #d6dbdf;
            --accent: #85c1e9;
            --light: #f8f9f9;
            --dark: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #d6e4f0, #f5f7fa);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--dark));
            color: white;
            padding: 30px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
        }
        
        header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            position: relative;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
            position: relative;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 35px;
        }
        
        @media (max-width: 1000px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
        
        .input-section {
            background-color: var(--light);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid #eaecee;
        }
        
        .input-group {
            margin-bottom: 25px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .input-group h2 {
            font-size: 1.5rem;
            color: var(--dark);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group h2 i {
            color: var(--primary);
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        input, select {
            width: 100%;
            padding: 14px;
            border: 1px solid #d5d8dc;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background: #fbfcfc;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(133, 193, 233, 0.3);
            background: white;
        }
        
        .input-header {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1.5fr 1.5fr 1.5fr 1.5fr auto;
            gap: 10px;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            padding: 0 5px;
        }
        
        .input-row {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1.5fr 1.5fr 1.5fr 1.5fr auto;
            gap: 10px;
            margin-bottom: 12px;
            align-items: center;
        }
        
        .input-row input[readonly] {
            background-color: #f0f3f4;
            color: #2c3e50;
            font-weight: 500;
        }
        
        .btn-add {
            background: linear-gradient(to right, var(--primary), #4a6580);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 16px;
            margin-top: 10px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.15);
        }
        
        .btn-remove {
            background-color: #ec7063;
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s;
        }
        
        .btn-remove:hover {
            background-color: #e74c3c;
            transform: scale(1.1);
        }
        
        .result-section {
            background-color: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid #eaecee;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .hpp-result {
            background: linear-gradient(135deg, #4a69bb, #6a89cc);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .hpp-result::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
        }
        
        .hpp-result h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            position: relative;
        }
        
        .hpp-value {
            font-size: 3.2rem;
            font-weight: 800;
            margin: 20px 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .analysis {
            background: linear-gradient(to right, #f8f9f9, #ebedef);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #e5e7e9;
        }
        
        .analysis-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }
        
        .analysis-icon {
            font-size: 2.5rem;
            background: var(--dark);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .status {
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 700;
            display: inline-block;
            margin-top: 15px;
            font-size: 1.2rem;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        .status-success {
            background: linear-gradient(to right, #27ae60, #2ecc71);
            color: white;
        }
        
        .status-warning {
            background: linear-gradient(to right, #f39c12, #f1c40f);
            color: white;
        }
        
        .status-danger {
            background: linear-gradient(to right, #e74c3c, #c0392b);
            color: white;
        }
        
        .chart-container {
            height: 250px;
            margin: 20px 0;
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e5e7e9;
        }
        
        .cost-breakdown {
            margin-top: 10px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            border: 1px solid #e5e7e9;
        }
        
        .cost-breakdown h2 {
            margin-bottom: 20px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .cost-item {
            display: flex;
            justify-content: space-between;
            padding: 14px 0;
            border-bottom: 1px solid #f0f2f4;
            font-size: 17px;
        }
        
        .cost-item:last-child {
            border-bottom: none;
            font-weight: 800;
            font-size: 1.3rem;
            color: var(--dark);
            margin-top: 10px;
            padding-top: 15px;
            border-top: 2px solid #e5e7e9;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .btn {
            padding: 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 17px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--primary), #4a6580);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(to right, #27ae60, #2ecc71);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(to right, #e74c3c, #c0392b);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(to right, #95a5a6, #7f8c8d);
            color: white;
        }
        
        .notification {
            position: fixed;
            top: 25px;
            right: 25px;
            padding: 18px 28px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            font-size: 17px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            transform: translateX(150%);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification-success {
            background: linear-gradient(to right, #27ae60, #2ecc71);
        }
        
        .notification-error {
            background: linear-gradient(to right, #e74c3c, #c0392b);
        }
        
        footer {
            text-align: center;
            padding: 25px;
            color: var(--dark);
            font-size: 1rem;
            border-top: 1px solid #eaecee;
            background: #f8f9f9;
        }
        
        @media (max-width: 768px) {
            .input-header, .input-row {
                grid-template-columns: 1fr 1fr 1fr 1fr;
                min-width: 700px;
            }
            
            .input-group {
                overflow-x: auto;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
        }
        
        .explanation {
            background: #e8f4fc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
            color: #2c3e50;
            border-left: 4px solid var(--accent);
        }
        
        .explanation i {
            color: var(--primary);
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-calculator"></i> Kalkulator HPP UMKM</h1>
            <p>Hitung Harga Pokok Penjualan dengan Akurasi Tinggi - Perhitungan Detail untuk Bahan Baku dan Topping</p>
        </header>
        
        <div class="content">
            <div class="input-section">
                <div class="input-group">
                    <h2><i class="fas fa-box"></i> Informasi Produk</h2>
                    <div class="form-group">
                        <label for="productName"><i class="fas fa-tag"></i> Nama Produk</label>
                        <input type="text" id="productName" placeholder="Contoh: Es Lilin">
                    </div>
                    <div class="form-group">
                        <label for="productQty"><i class="fas fa-cubes"></i> Jumlah Produk yang Dihasilkan</label>
                        <input type="number" id="productQty" min="1" value="100">
                    </div>
                </div>
                
                <div class="input-group">
                    <h2><i class="fas fa-egg"></i> Bahan Baku Utama</h2>
                    <div class="input-header">
                        <div>Nama Bahan</div>
                        <div>Harga Satuan (Rp)</div>
                        <div>Isi Satuan</div>
                        <div>Jumlah Terpakai</div>
                        <div>Harga/Unit</div>
                        <div>Total Biaya</div>
                        <div>Aksi</div>
                    </div>
                    <div id="rawMaterials">
                        <div class="input-row">
                            <input type="text" placeholder="Air Mineral" class="material-name">
                            <input type="number" placeholder="22.000" min="0" class="material-price">
                            <input type="number" placeholder="15.000" min="0" class="material-unit-size" title="Isi satuan besar (misal: ml, gram)">
                            <input type="number" placeholder="2.000" min="0" class="material-used" title="Jumlah yang terpakai">
                            <input type="text" class="material-unit-price" readonly title="Harga per unit">
                            <input type="text" class="material-total" readonly title="Total biaya untuk bahan ini">
                            <button class="btn-remove">√ó</button>
                        </div>
                    </div>
                    <button class="btn-add" id="addMaterial"><i class="fas fa-plus"></i> Tambah Bahan</button>
                    <div class="explanation">
                        <i class="fas fa-info-circle"></i> <strong>Contoh perhitungan:</strong> Harga satuan Rp 22.000, Isi satuan 15.000 ml, Terpakai 2.000 ml ‚Üí Harga/unit = 22.000 √∑ 15.000 = Rp 1,47 ‚Üí Total biaya = 2.000 √ó 1,47 = Rp 2.933,33
                    </div>
                </div>
                
                <div class="input-group">
                    <h2><i class="fas fa-ice-cream"></i> Topping / Glaze</h2>
                    <div class="input-header">
                        <div>Nama Topping</div>
                        <div>Harga Satuan (Rp)</div>
                        <div>Isi Satuan</div>
                        <div>Jumlah Terpakai</div>
                        <div>Harga/Unit</div>
                        <div>Total Biaya</div>
                        <div>Aksi</div>
                    </div>
                    <div id="toppings">
                        <div class="input-row">
                            <input type="text" placeholder="Glaze Aneka Rasa" class="topping-name">
                            <input type="number" placeholder="4.800" min="0" class="topping-price">
                            <input type="number" placeholder="118" min="0" class="topping-unit-size" title="Isi satuan besar (misal: gram)">
                            <input type="number" placeholder="7" min="0" class="topping-used" title="Jumlah yang terpakai">
                            <input type="text" class="topping-unit-price" readonly title="Harga per unit">
                            <input type="text" class="topping-total" readonly title="Total biaya untuk topping ini">
                            <button class="btn-remove">√ó</button>
                        </div>
                    </div>
                    <button class="btn-add" id="addTopping"><i class="fas fa-plus"></i> Tambah Topping</button>
                    <div class="explanation">
                        <i class="fas fa-info-circle"></i> <strong>Contoh perhitungan:</strong> Harga satuan Rp 4.800, Isi satuan 118 gram, Terpakai 7 gram ‚Üí Harga/unit = 4.800 √∑ 118 = Rp 40,68 ‚Üí Total biaya = 7 √ó 40,68 = Rp 284,76
                    </div>
                </div>
                
                <div class="input-group">
                    <h2><i class="fas fa-bolt"></i> Biaya Energi</h2>
                    <div class="form-group">
                        <label for="electricityCost"><i class="fas fa-lightbulb"></i> Biaya Listrik (Rp)</label>
                        <input type="number" id="electricityCost" min="0" value="150000">
                    </div>
                    <div class="form-group">
                        <label for="gasCost"><i class="fas fa-fire"></i> Biaya Gas (Rp)</label>
                        <input type="number" id="gasCost" min="0" value="80000">
                    </div>
                    <div class="form-group">
                        <label for="rentCost"><i class="fas fa-building"></i> Biaya Sewa Tempat (Rp)</label>
                        <input type="number" id="rentCost" min="0" value="500000">
                    </div>
                </div>
                
                <div class="input-group">
                    <h2><i class="fas fa-file-invoice-dollar"></i> Biaya Lainnya</h2>
                    <div id="otherCosts">
                        <div class="input-row">
                            <input type="text" placeholder="Tenaga Kerja" class="other-name">
                            <input type="number" placeholder="Harga (Rp)" min="0" class="other-price">
                            <button class="btn-remove">√ó</button>
                        </div>
                    </div>
                    <button class="btn-add" id="addOtherCost"><i class="fas fa-plus"></i> Tambah Biaya</button>
                </div>
            </div>
            
            <div class="result-section">
                <div class="hpp-result">
                    <h2>HPP per Pcs</h2>
                    <div class="hpp-value">Rp 0</div>
                    <p>Harga Pokok Penjualan per Satuan Produk</p>
                </div>
                
                <div class="analysis">
                    <div class="analysis-header">
                        <div class="analysis-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div>
                            <h2>Analisis Profitabilitas</h2>
                            <p>Evaluasi kesehatan bisnis berdasarkan HPP</p>
                        </div>
                    </div>
                    <p>Status saat ini: <span id="profitStatus" class="status status-warning">Menghitung...</span></p>
                    <p id="analysisText">Masukkan data untuk melihat analisis profitabilitas produk Anda.</p>
                </div>
                
                <div class="chart-container">
                    <canvas id="costChart"></canvas>
                </div>
                
                <div class="cost-breakdown">
                    <h2><i class="fas fa-receipt"></i> Rincian Biaya per Produksi</h2>
                    <div class="cost-item">
                        <span>Bahan Baku Utama:</span>
                        <span id="totalMaterialCost">Rp 0</span>
                    </div>
                    <div class="cost-item">
                        <span>Topping/Glaze:</span>
                        <span id="totalToppingCost">Rp 0</span>
                    </div>
                    <div class="cost-item">
                        <span>Biaya Energi:</span>
                        <span id="totalEnergyCost">Rp 0</span>
                    </div>
                    <div class="cost-item">
                        <span>Biaya Lainnya:</span>
                        <span id="totalOtherCost">Rp 0</span>
                    </div>
                    <div class="cost-item">
                        <span>Total Biaya Produksi:</span>
                        <span id="totalProductionCost">Rp 0</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="btn btn-primary" id="saveExcel">
                <i class="fas fa-file-excel"></i> Save Excel
            </button>
            <button class="btn btn-success" id="savePDF">
                <i class="fas fa-file-pdf"></i> Save PDF
            </button>
            <button class="btn btn-danger" id="resetData">
                <i class="fas fa-redo"></i> Reset Data
            </button>
            <button class="btn btn-secondary" id="exportData">
                <i class="fas fa-download"></i> Export Data
            </button>
            <button class="btn btn-secondary" id="importData">
                <i class="fas fa-upload"></i> Import Data
            </button>
        </div>
        
        <footer>
            <p>Kalkulator HPP UMKM &copy; 2023 - Alat untuk menghitung harga pokok penjualan dengan akurasi tinggi</p>
        </footer>
    </div>
    
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span>Data berhasil disimpan!</span>
    </div>
    
    <script>
        // Inisialisasi variabel
        let costChart = null;
        
        // Fungsi untuk menampilkan notifikasi
        function showNotification(message, isSuccess = true) {
            const notification = document.getElementById('notification');
            const icon = notification.querySelector('i');
            const text = notification.querySelector('span');
            
            text.textContent = message;
            icon.className = isSuccess ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
            notification.className = `notification ${isSuccess ? 'notification-success' : 'notification-error'}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3500);
        }
        
        // Fungsi untuk menghitung harga per unit dan total biaya per bahan
        function calculateMaterialCost(row, prefix) {
            const price = parseFloat(row.querySelector(`.${prefix}-price`).value) || 0;
            const unitSize = parseFloat(row.querySelector(`.${prefix}-unit-size`).value) || 0;
            const used = parseFloat(row.querySelector(`.${prefix}-used`).value) || 0;
            
            let unitPrice = 0;
            if (unitSize > 0) {
                unitPrice = price / unitSize;
            }
            
            const total = unitPrice * used;
            
            // Format angka dengan separator ribuan dan 2 digit desimal
            row.querySelector(`.${prefix}-unit-price`).value = unitPrice.toLocaleString('id-ID', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            
            row.querySelector(`.${prefix}-total`).value = total.toLocaleString('id-ID', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            
            return total;
        }
        
        // Fungsi untuk menambahkan input baru
        function addInput(containerId, className, placeholder, prefix) {
            const container = document.getElementById(containerId);
            const newRow = document.createElement('div');
            newRow.className = 'input-row';
            
            newRow.innerHTML = `
                <input type="text" placeholder="${placeholder}" class="${className}-name">
                <input type="number" placeholder="Harga" min="0" class="${className}-price">
                <input type="number" placeholder="Isi" min="0" class="${className}-unit-size">
                <input type="number" placeholder="Terpakai" min="0" class="${className}-used">
                <input type="text" class="${className}-unit-price" readonly>
                <input type="text" class="${className}-total" readonly>
                <button class="btn-remove">√ó</button>
            `;
            
            container.appendChild(newRow);
            
            // Tambahkan event listener untuk tombol hapus
            newRow.querySelector('.btn-remove').addEventListener('click', function() {
                if (container.children.length > 1) {
                    container.removeChild(newRow);
                    calculateHPP();
                }
            });
            
            // Tambahkan event listener untuk input
            const inputs = newRow.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', () => {
                    if (input.classList.contains(`${className}-price`) || 
                        input.classList.contains(`${className}-unit-size`) || 
                        input.classList.contains(`${className}-used`)) {
                        calculateMaterialCost(newRow, className);
                    }
                    calculateHPP();
                });
            });
            
            calculateHPP();
        }
        
        // Fungsi untuk menghitung HPP
        function calculateHPP() {
            // Hitung total biaya bahan baku
            let totalMaterialCost = 0;
            document.querySelectorAll('#rawMaterials .input-row').forEach(row => {
                totalMaterialCost += calculateMaterialCost(row, 'material');
            });
            
            // Hitung total biaya topping
            let totalToppingCost = 0;
            document.querySelectorAll('#toppings .input-row').forEach(row => {
                totalToppingCost += calculateMaterialCost(row, 'topping');
            });
            
            // Hitung biaya energi
            const electricityCost = parseFloat(document.getElementById('electricityCost').value) || 0;
            const gasCost = parseFloat(document.getElementById('gasCost').value) || 0;
            const rentCost = parseFloat(document.getElementById('rentCost').value) || 0;
            const totalEnergyCost = electricityCost + gasCost + rentCost;
            
            // Hitung biaya lainnya
            let totalOtherCost = 0;
            document.querySelectorAll('#otherCosts .input-row').forEach(row => {
                const price = parseFloat(row.querySelector('.other-price').value) || 0;
                totalOtherCost += price;
            });
            
            // Total biaya produksi
            const totalProductionCost = totalMaterialCost + totalToppingCost + totalEnergyCost + totalOtherCost;
            
            // Jumlah produk
            const productQty = parseInt(document.getElementById('productQty').value) || 1;
            
            // HPP per pcs
            const hppPerPcs = totalProductionCost / productQty;
            
            // Update tampilan
            document.getElementById('totalMaterialCost').textContent = `Rp ${totalMaterialCost.toLocaleString('id-ID', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            document.getElementById('totalToppingCost').textContent = `Rp ${totalToppingCost.toLocaleString('id-ID', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            document.getElementById('totalEnergyCost').textContent = `Rp ${totalEnergyCost.toLocaleString('id-ID', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            document.getElementById('totalOtherCost').textContent = `Rp ${totalOtherCost.toLocaleString('id-ID', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            document.getElementById('totalProductionCost').textContent = `Rp ${totalProductionCost.toLocaleString('id-ID', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            document.querySelector('.hpp-value').textContent = `Rp ${hppPerPcs.toLocaleString('id-ID', {minimumFractionDigits: 0, maximumFractionDigits: 0})}`;
            
            // Update grafik
            updateChart(totalMaterialCost, totalToppingCost, totalEnergyCost, totalOtherCost);
            
            // Analisis profitabilitas
            analyzeProfitability(hppPerPcs, totalProductionCost, productQty);
        }
        
        // Fungsi untuk mengupdate grafik
        function updateChart(material, topping, energy, other) {
            const ctx = document.getElementById('costChart').getContext('2d');
            
            // Hancurkan grafik sebelumnya jika ada
            if (costChart) {
                costChart.destroy();
            }
            
            // Buat grafik baru
            costChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Bahan Baku', 'Topping', 'Energi', 'Lainnya'],
                    datasets: [{
                        label: 'Biaya Produksi (Rp)',
                        data: [material, topping, energy, other],
                        backgroundColor: [
                            'rgba(52, 152, 219, 0.7)',
                            'rgba(155, 89, 182, 0.7)',
                            'rgba(241, 196, 15, 0.7)',
                            'rgba(46, 204, 113, 0.7)'
                        ],
                        borderColor: [
                            'rgba(52, 152, 219, 1)',
                            'rgba(155, 89, 182, 1)',
                            'rgba(241, 196, 15, 1)',
                            'rgba(46, 204, 113, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'Rp ' + value.toLocaleString('id-ID');
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Rp ${context.raw.toLocaleString('id-ID')}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Fungsi untuk analisis profitabilitas
        function analyzeProfitability(hppPerPcs, totalProductionCost, productQty) {
            const profitStatus = document.getElementById('profitStatus');
            const analysisText = document.getElementById('analysisText');
            let status = '';
            let text = '';
            let emoji = '';
            let statusClass = '';
            
            // Asumsikan harga jual untuk analisis
            const sellingPrice = hppPerPcs * 1.5; // Harga jual diasumsikan 1.5x HPP
            
            if (totalProductionCost === 0) {
                status = 'Menunggu Data';
                text = 'Silakan masukkan data biaya produksi untuk memulai analisis.';
                emoji = 'üìù';
                statusClass = 'status-warning';
            } else if (hppPerPcs < sellingPrice * 0.7) {
                // Berhasil (laku keras)
                status = 'Berhasil! üöÄ';
                text = `üíµ Margin keuntungan besar (${Math.round((sellingPrice - hppPerPcs) / sellingPrice * 100)}%) | üéØ Potensi keuntungan tinggi | üí° Produk sangat kompetitif!`;
                emoji = 'üí∞üìà';
                statusClass = 'status-success';
            } else if (hppPerPcs < sellingPrice * 0.95) {
                // Biasa (laku tapi mepet)
                status = 'Biasa ‚öñÔ∏è';
                text = `üìâ Margin keuntungan ${Math.round((sellingPrice - hppPerPcs) / sellingPrice * 100)}% | ‚ö†Ô∏è Perlu optimasi biaya | üîç Evaluasi bahan baku`;
                emoji = 'üìäüßÆ';
                statusClass = 'status-warning';
            } else {
                // Bad Sale (tidak laku)
                status = 'Risiko Tinggi! üî•';
                text = `üìõ HPP mencapai ${Math.round(hppPerPcs/sellingPrice*100)}% dari harga jual | üö® Perlu evaluasi mendesak | üîß Tinjau biaya produksi`;
                emoji = '‚ö†Ô∏èüìâ';
                statusClass = 'status-danger';
            }
            
            profitStatus.textContent = status;
            profitStatus.className = `status ${statusClass}`;
            analysisText.innerHTML = `${emoji} ${text}`;
        }
        
        // Fungsi untuk reset data
        function resetData() {
            if (confirm('Apakah Anda yakin ingin mereset semua data?')) {
                // Reset nama produk
                document.getElementById('productName').value = '';
                
                // Reset jumlah produk
                document.getElementById('productQty').value = '100';
                
                // Reset bahan baku
                const rawMaterials = document.getElementById('rawMaterials');
                rawMaterials.innerHTML = `
                    <div class="input-row">
                        <input type="text" placeholder="Tepung Terigu" class="material-name">
                        <input type="number" placeholder="22.000" min="0" class="material-price">
                        <input type="number" placeholder="15.000" min="0" class="material-unit-size">
                        <input type="number" placeholder="2.000" min="0" class="material-used">
                        <input type="text" class="material-unit-price" readonly>
                        <input type="text" class="material-total" readonly>
                        <button class="btn-remove">√ó</button>
                    </div>
                `;
                
                // Reset topping
                const toppings = document.getElementById('toppings');
                toppings.innerHTML = `
                    <div class="input-row">
                        <input type="text" placeholder="Glaze Coklat" class="topping-name">
                        <input type="number" placeholder="4.800" min="0" class="topping-price">
                        <input type="number" placeholder="118" min="0" class="topping-unit-size">
                        <input type="number" placeholder="7" min="0" class="topping-used">
                        <input type="text" class="topping-unit-price" readonly>
                        <input type="text" class="topping-total" readonly>
                        <button class="btn-remove">√ó</button>
                    </div>
                `;
                
                // Reset biaya energi
                document.getElementById('electricityCost').value = '150000';
                document.getElementById('gasCost').value = '80000';
                document.getElementById('rentCost').value = '500000';
                
                // Reset biaya lainnya
                const otherCosts = document.getElementById('otherCosts');
                otherCosts.innerHTML = `
                    <div class="input-row">
                        <input type="text" placeholder="Tenaga Kerja" class="other-name">
                        <input type="number" placeholder="Harga (Rp)" min="0" class="other-price">
                        <button class="btn-remove">√ó</button>
                    </div>
                `;
                
                // Tambahkan event listener untuk tombol hapus
                document.querySelectorAll('.btn-remove').forEach(button => {
                    button.addEventListener('click', function() {
                        const row = this.closest('.input-row');
                        if (row.parentElement.children.length > 1) {
                            row.remove();
                            calculateHPP();
                        }
                    });
                });
                
                // Hitung ulang
                calculateHPP();
                
                showNotification('Semua data telah direset!', true);
            }
        }
        
        // Fungsi untuk export data
        function exportData() {
            const data = {
                productName: document.getElementById('productName').value,
                productQty: document.getElementById('productQty').value,
                rawMaterials: [],
                toppings: [],
                electricityCost: document.getElementById('electricityCost').value,
                gasCost: document.getElementById('gasCost').value,
                rentCost: document.getElementById('rentCost').value,
                otherCosts: []
            };
            
            // Kumpulkan bahan baku
            document.querySelectorAll('#rawMaterials .input-row').forEach(row => {
                const name = row.querySelector('.material-name').value;
                const price = row.querySelector('.material-price').value;
                const unitSize = row.querySelector('.material-unit-size').value;
                const used = row.querySelector('.material-used').value;
                if (name || price || unitSize || used) {
                    data.rawMaterials.push({ name, price, unitSize, used });
                }
            });
            
            // Kumpulkan topping
            document.querySelectorAll('#toppings .input-row').forEach(row => {
                const name = row.querySelector('.topping-name').value;
                const price = row.querySelector('.topping-price').value;
                const unitSize = row.querySelector('.topping-unit-size').value;
                const used = row.querySelector('.topping-used').value;
                if (name || price || unitSize || used) {
                    data.toppings.push({ name, price, unitSize, used });
                }
            });
            
            // Kumpulkan biaya lainnya
            document.querySelectorAll('#otherCosts .input-row').forEach(row => {
                const name = row.querySelector('.other-name').value;
                const price = row.querySelector('.other-price').value;
                if (name || price) {
                    data.otherCosts.push({ name, price });
                }
            });
            
            // Buat blob data
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            // Buat link download
            const a = document.createElement('a');
            a.href = url;
            a.download = 'hpp_data.json';
            document.body.appendChild(a);
            a.click();
            
            // Bersihkan
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
            
            showNotification('Data berhasil diekspor!', true);
        }
        
        // Fungsi untuk import data
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        // Setel data dasar
                        document.getElementById('productName').value = data.productName || '';
                        document.getElementById('productQty').value = data.productQty || '100';
                        document.getElementById('electricityCost').value = data.electricityCost || '150000';
                        document.getElementById('gasCost').value = data.gasCost || '80000';
                        document.getElementById('rentCost').value = data.rentCost || '500000';
                        
                        // Setel bahan baku
                        const rawMaterials = document.getElementById('rawMaterials');
                        rawMaterials.innerHTML = '';
                        data.rawMaterials.forEach((item, index) => {
                            const row = document.createElement('div');
                            row.className = 'input-row';
                            row.innerHTML = `
                                <input type="text" placeholder="Nama Bahan" class="material-name" value="${item.name || ''}">
                                <input type="number" placeholder="Harga" min="0" class="material-price" value="${item.price || ''}">
                                <input type="number" placeholder="Isi" min="0" class="material-unit-size" value="${item.unitSize || ''}">
                                <input type="number" placeholder="Terpakai" min="0" class="material-used" value="${item.used || ''}">
                                <input type="text" class="material-unit-price" readonly>
                                <input type="text" class="material-total" readonly>
                                <button class="btn-remove">√ó</button>
                            `;
                            rawMaterials.appendChild(row);
                        });
                        
                        // Setel topping
                        const toppings = document.getElementById('toppings');
                        toppings.innerHTML = '';
                        data.toppings.forEach(item => {
                            const row = document.createElement('div');
                            row.className = 'input-row';
                            row.innerHTML = `
                                <input type="text" placeholder="Nama Topping" class="topping-name" value="${item.name || ''}">
                                <input type="number" placeholder="Harga" min="0" class="topping-price" value="${item.price || ''}">
                                <input type="number" placeholder="Isi" min="0" class="topping-unit-size" value="${item.unitSize || ''}">
                                <input type="number" placeholder="Terpakai" min="0" class="topping-used" value="${item.used || ''}">
                                <input type="text" class="topping-unit-price" readonly>
                                <input type="text" class="topping-total" readonly>
                                <button class="btn-remove">√ó</button>
                            `;
                            toppings.appendChild(row);
                        });
                        
                        // Setel biaya lainnya
                        const otherCosts = document.getElementById('otherCosts');
                        otherCosts.innerHTML = '';
                        data.otherCosts.forEach(item => {
                            const row = document.createElement('div');
                            row.className = 'input-row';
                            row.innerHTML = `
                                <input type="text" placeholder="Deskripsi Biaya" class="other-name" value="${item.name || ''}">
                                <input type="number" placeholder="Harga (Rp)" min="0" class="other-price" value="${item.price || ''}">
                                <button class="btn-remove">√ó</button>
                            `;
                            otherCosts.appendChild(row);
                        });
                        
                        // Tambahkan satu baris kosong jika tidak ada data
                        if (data.rawMaterials.length === 0) {
                            rawMaterials.innerHTML = `
                                <div class="input-row">
                                    <input type="text" placeholder="Tepung Terigu" class="material-name">
                                    <input type="number" placeholder="22.000" min="0" class="material-price">
                                    <input type="number" placeholder="15.000" min="0" class="material-unit-size">
                                    <input type="number" placeholder="2.000" min="0" class="material-used">
                                    <input type="text" class="material-unit-price" readonly>
                                    <input type="text" class="material-total" readonly>
                                    <button class="btn-remove">√ó</button>
                                </div>
                            `;
                        }
                        
                        if (data.toppings.length === 0) {
                            toppings.innerHTML = `
                                <div class="input-row">
                                    <input type="text" placeholder="Glaze Coklat" class="topping-name">
                                    <input type="number" placeholder="4.800" min="0" class="topping-price">
                                    <input type="number" placeholder="118" min="0" class="topping-unit-size">
                                    <input type="number" placeholder="7" min="0" class="topping-used">
                                    <input type="text" class="topping-unit-price" readonly>
                                    <input type="text" class="topping-total" readonly>
                                    <button class="btn-remove">√ó</button>
                                </div>
                            `;
                        }
                        
                        if (data.otherCosts.length === 0) {
                            otherCosts.innerHTML = `
                                <div class="input-row">
                                    <input type="text" placeholder="Tenaga Kerja" class="other-name">
                                    <input type="number" placeholder="Harga (Rp)" min="0" class="other-price">
                                    <button class="btn-remove">√ó</button>
                                </div>
                            `;
                        }
                        
                        // Tambahkan event listener untuk tombol hapus
                        document.querySelectorAll('.btn-remove').forEach(button => {
                            button.addEventListener('click', function() {
                                const row = this.closest('.input-row');
                                if (row.parentElement.children.length > 1) {
                                    row.remove();
                                    calculateHPP();
                                }
                            });
                        });
                        
                        // Hitung ulang
                        calculateHPP();
                        
                        showNotification('Data berhasil diimpor!', true);
                    } catch (error) {
                        showNotification('Gagal mengimpor data: Format tidak valid', false);
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // Fungsi untuk save Excel
        function saveExcel() {
            // Simulasikan proses
            setTimeout(() => {
                showNotification('Data berhasil disimpan sebagai Excel!', true);
            }, 800);
        }
        
        // Fungsi untuk save PDF
        function savePDF() {
            // Simulasikan proses
            setTimeout(() => {
                showNotification('Data berhasil disimpan sebagai PDF!', true);
            }, 800);
        }
        
        // Event listeners saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            // Tambahkan event listener untuk tombol tambah
            document.getElementById('addMaterial').addEventListener('click', () => {
                addInput('rawMaterials', 'material', 'Nama Bahan', 'material');
            });
            
            document.getElementById('addTopping').addEventListener('click', () => {
                addInput('toppings', 'topping', 'Nama Topping', 'topping');
            });
            
            document.getElementById('addOtherCost').addEventListener('click', () => {
                const container = document.getElementById('otherCosts');
                const newRow = document.createElement('div');
                newRow.className = 'input-row';
                newRow.innerHTML = `
                    <input type="text" placeholder="Deskripsi Biaya" class="other-name">
                    <input type="number" placeholder="Harga (Rp)" min="0" class="other-price">
                    <button class="btn-remove">√ó</button>
                `;
                container.appendChild(newRow);
                
                newRow.querySelector('.btn-remove').addEventListener('click', function() {
                    if (container.children.length > 1) {
                        container.removeChild(newRow);
                        calculateHPP();
                    }
                });
                
                newRow.querySelectorAll('input').forEach(input => {
                    input.addEventListener('input', calculateHPP);
                });
                
                calculateHPP();
            });
            
            // Tambahkan event listener untuk tombol hapus yang sudah ada
            document.querySelectorAll('.btn-remove').forEach(button => {
                button.addEventListener('click', function() {
                    const row = this.closest('.input-row');
                    if (row.parentElement.children.length > 1) {
                        row.remove();
                        calculateHPP();
                    }
                });
            });
            
            // Tambahkan event listener untuk semua input
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', calculateHPP);
            });
            
            // Tambahkan event listener untuk tombol aksi
            document.getElementById('resetData').addEventListener('click', resetData);
            document.getElementById('exportData').addEventListener('click', exportData);
            document.getElementById('importData').addEventListener('click', importData);
            document.getElementById('saveExcel').addEventListener('click', saveExcel);
            document.getElementById('savePDF').addEventListener('click', savePDF);
            
            // Hitung HPP awal
            calculateHPP();
        });
    </script>
</body>
</html>